<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="author" content="Shaojun Xie" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <title>Visualizing tweets and the Logistic Regression model - Note for Natural Language Processing with Classification and Vector Spaces</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Visualizing tweets and the Logistic Regression model";
        var mkdocs_page_input_path = "C1_W1_lecture_nb_03_logistic_regression_model.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/yaml.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/rust.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href=".." class="icon icon-home"> Note for Natural Language Processing with Classification and Vector Spaces
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption"><span class="caption-text">Sentiment Analysis with Logistic Regression</span></p>
              <ul class="current">
                  <li class="toctree-l1"><a class="reference internal" href="../C1_W1_lecture_nb_01_preprocessing/">Natural Language preprocessing</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../C1_W1_lecture_nb_02_word%20frequencies/">Building and Visualizing word frequencies</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../Logistic_Regression_training/">Logistic Regression training</a>
                  </li>
                  <li class="toctree-l1 current"><a class="reference internal current" href="#">Visualizing tweets and the Logistic Regression model</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#import-the-required-libraries">Import the required libraries</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#load-the-nltk-sample-dataset">Load the NLTK sample dataset</a>
    </li>
    </ul>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Sentiment Analysis with naïve Bayes</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../C1_W2_lecture_nb_01_visualizing_naive_bayes/">Visualizing likelihoods and confidence ellipses</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../C1_W2_Testing_naive_Bayes/">Testing naïve Bayes</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="..">Note for Natural Language Processing with Classification and Vector Spaces</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href=".." class="icon icon-home" aria-label="Docs"></a></li>
          <li class="breadcrumb-item">Sentiment Analysis with Logistic Regression</li>
      <li class="breadcrumb-item active">Visualizing tweets and the Logistic Regression model</li>
    <li class="wy-breadcrumbs-aside">
          <a href="https://github.com/xie186/coursera_NLP_deep_learning.git/edit/master/docs/C1_W1_lecture_nb_03_logistic_regression_model.md">Edit on xie186/coursera_NLP_deep_learning</a>
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="visualizing-tweets-and-the-logistic-regression-model">Visualizing tweets and the Logistic Regression model</h1>
<p><strong>Objectives:</strong> Visualize and interpret the logistic regression model</p>
<p><strong>Steps:</strong>
* Plot tweets in a scatter plot using their positive and negative sums.
* Plot the output of the logistic regression model in the same plot as a solid line</p>
<h2 id="import-the-required-libraries">Import the required libraries</h2>
<p>We will be using <a href="http://www.nltk.org/howto/twitter.html"><em>NLTK</em></a>, an opensource NLP library, for collecting, handling, and processing Twitter data. In this lab, we will use the example dataset that comes alongside with NLTK. This dataset has been manually annotated and serves to establish baselines for models quickly. </p>
<p>So, to start, let's import the required libraries. </p>
<pre><code class="language-python">import nltk                         # NLP toolbox
from os import getcwd
import pandas as pd                 # Library for Dataframes 
from nltk.corpus import twitter_samples 
import matplotlib.pyplot as plt     # Library for visualization
import numpy as np                  # Library for math functions

from utils import process_tweet, build_freqs # Our functions for NLP

nltk.download('twitter_samples')
</code></pre>
<pre><code>[nltk_data] Downloading package twitter_samples to
[nltk_data]     /Users/xies4/nltk_data...
[nltk_data]   Package twitter_samples is already up-to-date!





True
</code></pre>
<h2 id="load-the-nltk-sample-dataset">Load the NLTK sample dataset</h2>
<p>To complete this lab, you need the sample dataset of the previous lab. Here, we assume the files are already available, and we only need to load into Python lists.</p>
<pre><code class="language-python"># select the set of positive and negative tweets
all_positive_tweets = twitter_samples.strings('positive_tweets.json')
all_negative_tweets = twitter_samples.strings('negative_tweets.json')

tweets = all_positive_tweets + all_negative_tweets ## Concatenate the lists. 
labels = np.append(np.ones((len(all_positive_tweets),1)), np.zeros((len(all_negative_tweets),1)), axis = 0)

# split the data into two pieces, one for training and one for testing (validation set) 
train_pos  = all_positive_tweets[:4000]
train_neg  = all_negative_tweets[:4000]

train_x = train_pos + train_neg 

print(&quot;Number of tweets: &quot;, len(train_x))
</code></pre>
<pre><code>Number of tweets:  8000
</code></pre>
<h1 id="load-the-extracted-features">Load the extracted features</h1>
<p>Part of this week's assignment is the creation of the numerical features needed for the Logistic regression model. In order not to interfere with it, we have previously calculated and stored these features in a CSV file for the entire training set.</p>
<p>So, please load these features created for the tweets sample. </p>
<pre><code class="language-python">data = pd.read_csv('./data/logistic_features.csv'); # Load a 3 columns csv file using pandas function
data.head(10) # Print the first 10 data entries
</code></pre>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>bias</th>
      <th>positive</th>
      <th>negative</th>
      <th>sentiment</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1.0</td>
      <td>3020.0</td>
      <td>61.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1.0</td>
      <td>3573.0</td>
      <td>444.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1.0</td>
      <td>3005.0</td>
      <td>115.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1.0</td>
      <td>2862.0</td>
      <td>4.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1.0</td>
      <td>3119.0</td>
      <td>225.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>5</th>
      <td>1.0</td>
      <td>2955.0</td>
      <td>119.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>6</th>
      <td>1.0</td>
      <td>3934.0</td>
      <td>538.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>7</th>
      <td>1.0</td>
      <td>3162.0</td>
      <td>276.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>8</th>
      <td>1.0</td>
      <td>628.0</td>
      <td>189.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>9</th>
      <td>1.0</td>
      <td>264.0</td>
      <td>112.0</td>
      <td>1.0</td>
    </tr>
  </tbody>
</table>
</div>

<p>Now let us get rid of the data frame to keep only Numpy arrays.</p>
<pre><code class="language-python"># Each feature is labeled as bias, positive and negative
X = data[['bias', 'positive', 'negative']].values # Get only the numerical values of the dataframe
Y = data['sentiment'].values; # Put in Y the corresponding labels or sentiments

print(X.shape) # Print the shape of the X part
print(X) # Print some rows of X
</code></pre>
<pre><code>(8000, 3)
[[1.000e+00 3.020e+03 6.100e+01]
 [1.000e+00 3.573e+03 4.440e+02]
 [1.000e+00 3.005e+03 1.150e+02]
 ...
 [1.000e+00 1.440e+02 7.830e+02]
 [1.000e+00 2.050e+02 3.890e+03]
 [1.000e+00 1.890e+02 3.974e+03]]
</code></pre>
<h2 id="load-a-pretrained-logistic-regression-model">Load a pretrained Logistic Regression model</h2>
<p>In the same way, as part of this week's assignment, a Logistic regression model must be trained. The next cell contains the resulting model from such training. Notice that a list of 3 numeric values represents the whole model, that we have called <em>theta</em> <span class="arithmatex">\(\theta\)</span>.</p>
<pre><code class="language-python">theta = [6.03518871e-08, 5.38184972e-04, -5.58300168e-04]
</code></pre>
<h2 id="plot-the-samples-in-a-scatter-plot">Plot the samples in a scatter plot</h2>
<p>The vector theta represents a plane that split our feature space into two parts. Samples located over that plane are considered positive, and samples located under that plane are considered negative. Remember that we have a 3D feature space, i.e., each tweet is represented as a vector comprised of three values: <code>[bias, positive_sum, negative_sum]</code>, always having <code>bias = 1</code>. </p>
<p>If we ignore the bias term, we can plot each tweet in a cartesian plane, using <code>positive_sum</code> and <code>negative_sum</code>. In the cell below, we do precisely this. Additionally, we color each tweet, depending on its class. Positive tweets will be green and negative tweets will be red.</p>
<pre><code class="language-python"># Plot the samples using columns 1 and 2 of the matrix
fig, ax = plt.subplots(figsize = (8, 8))

colors = ['red', 'green']

# Color based on the sentiment Y
ax.scatter(X[:,1], X[:,2], c=[colors[int(k)] for k in Y], s = 0.1)  # Plot a dot for each pair of words
plt.xlabel(&quot;Positive&quot;)
plt.ylabel(&quot;Negative&quot;)
</code></pre>
<pre><code>Text(0, 0.5, 'Negative')
</code></pre>
<p><img alt="png" src="../C1_W1_lecture_nb_03_logistic_regression_model_files/C1_W1_lecture_nb_03_logistic_regression_model_12_1.png" /></p>
<p>From the plot, it is evident that the features that we have chosen to represent tweets as numerical vectors allow an almost perfect separation between positive and negative tweets. So you can expect a very high accuracy for this model! </p>
<h2 id="plot-the-model-alongside-the-data">Plot the model alongside the data</h2>
<p>We will draw a gray line to show the cutoff between the positive and negative regions. In other words, the gray line marks the line where $$ z = \theta * x = 0.$$
To draw this line, we have to solve the above equation in terms of one of the independent variables.</p>
<div class="arithmatex">\[ z = \theta * x = 0$$
$$ x = [1, pos, neg] $$
$$ z(\theta, x) = \theta_0+ \theta_1 * pos + \theta_2 * neg = 0 $$
$$ neg = (-\theta_0 - \theta_1 * pos) / \theta_2 \]</div>
<p>The red and green lines that point in the direction of the corresponding sentiment are calculated using a perpendicular line to the separation line calculated in the previous equations (neg function). It must point in the same direction as the derivative of the Logit function, but the magnitude may differ. It is only for a visual representation of the model. </p>
<div class="arithmatex">\[direction = pos * \theta_2 / \theta_1\]</div>
<pre><code class="language-python"># Equation for the separation plane
# It give a value in the negative axe as a function of a positive value
# f(pos, neg, W) = w0 + w1 * pos + w2 * neg = 0
# s(pos, W) = (-w0 - w1 * pos) / w2
def neg(theta, pos):
    return (-theta[0] - pos * theta[1]) / theta[2]

# Equation for the direction of the sentiments change
# We don't care about the magnitude of the change. We are only interested 
# in the direction. So this direction is just a perpendicular function to the 
# separation plane
# df(pos, W) = pos * w2 / w1
def direction(theta, pos):
    return    pos * theta[2] / theta[1]
</code></pre>
<p>The green line in the chart points in the direction where z &gt; 0 and the red line points in the direction where z &lt; 0. The direction of these lines are given by the weights <span class="arithmatex">\(\theta_1\)</span> and <span class="arithmatex">\(\theta_2\)</span></p>
<pre><code class="language-python"># Plot the samples using columns 1 and 2 of the matrix
fig, ax = plt.subplots(figsize = (8, 8))

colors = ['red', 'green']

# Color base on the sentiment Y
ax.scatter(X[:,1], X[:,2], c=[colors[int(k)] for k in Y], s = 0.1)  # Plot a dot for each pair of words
plt.xlabel(&quot;Positive&quot;)
plt.ylabel(&quot;Negative&quot;)

# Now lets represent the logistic regression model in this chart. 
maxpos = np.max(X[:,1])

offset = 5000 # The pos value for the direction vectors origin

# Plot a gray line that divides the 2 areas.
ax.plot([0,  maxpos], [neg(theta, 0),   neg(theta, maxpos)], color = 'gray') 

# Plot a green line pointing to the positive direction
ax.arrow(offset, neg(theta, offset), offset, direction(theta, offset), head_width=500, head_length=500, fc='g', ec='g')
# Plot a red line pointing to the negative direction
ax.arrow(offset, neg(theta, offset), -offset, -direction(theta, offset), head_width=500, head_length=500, fc='r', ec='r')

plt.show()
</code></pre>
<p><img alt="png" src="../C1_W1_lecture_nb_03_logistic_regression_model_files/C1_W1_lecture_nb_03_logistic_regression_model_16_0.png" /></p>
<p><strong>Note that more critical than the Logistic regression itself, are the features extracted from tweets that allow getting the right results in this exercise.</strong></p>
<p>That is all, folks. Hopefully, now you understand better what the Logistic regression model represents, and why it works that well for this specific problem. </p>
<pre><code class="language-python">
</code></pre>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../Logistic_Regression_training/" class="btn btn-neutral float-left" title="Logistic Regression training"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../C1_W2_lecture_nb_01_visualizing_naive_bayes/" class="btn btn-neutral float-right" title="Visualizing likelihoods and confidence ellipses">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/xie186/coursera_NLP_deep_learning.git" class="fa fa-code-fork" style="color: #fcfcfc"> xie186/coursera_NLP_deep_learning</a>
        </span>
    
    
      <span><a href="../Logistic_Regression_training/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../C1_W2_lecture_nb_01_visualizing_naive_bayes/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../javascripts/mathjax.js"></script>
      <script src="https://unpkg.com/mathjax@3/es5/tex-mml-chtml.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
